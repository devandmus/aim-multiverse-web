---
import BaseLayout from "./BaseLayout.astro";
import ArticleNavigation from "../components/ArticleNavigation.astro";
import { getCollection } from "astro:content";
import { format } from "date-fns";
import { es } from "date-fns/locale";
import { Image } from "astro:assets";
import andresCuadrado from "../assets/images/andres-cuadrado.jpg";

export interface Props {
  frontmatter: any;
  url: string;
  currentPost: any;
}

const { frontmatter, url, currentPost } = Astro.props;

// Función para formatear fecha de manera segura
function formatDate(date: any): string {
  if (!date) return "Fecha no disponible";

  try {
    const dateObj = new Date(date);
    if (isNaN(dateObj.getTime())) {
      return "Fecha no disponible";
    }
    return format(dateObj, "dd MMMM yyyy", { locale: es });
  } catch (error) {
    return "Fecha no disponible";
  }
}

// Obtener todos los posts para RelatedArticles
const allPosts = await getCollection("blog");
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
  <main class="min-h-screen bg-black pb-12">
    <!-- Hero Section -->
    <section class="relative py-20">
      <div class="max-w-6xl mx-auto px-6">
        <div class="text-center">
          <h1
            class="text-5xl md:text-6xl font-bold text-white mb-6 leading-tight pt-6 md:pt-12"
            style={`view-transition-name: article-title-${currentPost.slug}`}
          >
            {frontmatter.title}
          </h1>

          <div class="max-w-3xl mx-auto">
            <p class="text-xl text-gray-300 leading-relaxed mb-8">
              {frontmatter.description}
            </p>
            <!-- Autor Section -->
            <div class="flex justify-center mb-8">
              <a href="/about">
                <div class="flex items-center justify-center gap-4">
                  <div
                    class="w-12 h-12 rounded-full overflow-hidden border-2 border-neon-cyan"
                  >
                    <Image
                      src={andresCuadrado}
                      alt="Andrés Maldonado"
                      width={96}
                      height={96}
                      class="w-full h-full object-cover"
                    />
                  </div>
                  <div class="text-left">
                    <div class="text-white font-semibold text-lg">
                      Andrés Ignacio Maldonado
                    </div>
                    <div class="text-gray-400 text-sm">
                      Tech Lead | AI | Marketer | Musician
                    </div>
                  </div>
                </div>
              </a>
            </div>
            <!-- Metadatos -->
            <div class="flex flex-wrap items-center gap-4 justify-center">
              <div class="flex items-center gap-2">
                <svg
                  class="w-4 h-4 text-neon-cyan"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                    clip-rule="evenodd"></path>
                </svg>
                <span class="text-sm">
                  {formatDate(frontmatter.pubDate)}
                </span>
              </div>

              {
                frontmatter.readingTime && (
                  <div class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-neon-pink"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span class="text-sm">{frontmatter.readingTime}</span>
                  </div>
                )
              }

              {
                frontmatter.category && (
                  <div class="flex items-center gap-2">
                    <svg
                      class="w-4 h-4 text-neon-yellow"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10a1 1 0 01.293-.707l7-7a1 1 0 011.414 0l7 7zM5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span class="text-sm">{frontmatter.category}</span>
                  </div>
                )
              }
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Content -->
    <div class="max-w-3xl mx-auto">
      <div class="blog-content-wrapper">
        <slot />
      </div>
    </div>

    <!-- Navegación de artículos -->
    <ArticleNavigation currentPost={currentPost} allPosts={allPosts} />
  </main>
</BaseLayout>
