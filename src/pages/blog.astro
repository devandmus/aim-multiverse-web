---
import BaseLayout from "../layouts/BaseLayout.astro";
import NeonBox from "../components/atoms/NeonBox.astro";
import Wrapper from "../components/skeleton/Wrapper.astro";
import SearchBox from "../components/SearchBox.astro";
import CategoryFilter from "../components/CategoryFilter.astro";
import FeaturedSection from "../components/FeaturedSection.astro";
import ArticlesGrid from "../components/ArticlesGrid.astro";
import SubscriptionSection from "../components/SubscriptionSection.astro";
import {
  getAllPosts,
  getFeaturedPosts,
  getRandomSuggestions,
  getColorByCategory,
  getPostUrl,
} from "../lib/blog";

// Obtener artículos para mostrar en el blog
const allPosts = await getAllPosts();
const publishedPosts = allPosts;

// Obtener artículo destacado
const featuredPosts = await getFeaturedPosts();
const featuredPost = featuredPosts[0]; // Tomar el primero si hay múltiples
const regularPosts = publishedPosts.filter((post) => !post.data.featured);

// Obtener artículos para sugerencias aleatorias
const randomSuggestions = getRandomSuggestions(allPosts, undefined, 6);

// Configuración de categorías para el filtro
const categories = [
  { name: "AI", color: "cyan" as const },
  { name: "Liderazgo", color: "yellow" as const },
  { name: "Dev", color: "purple" as const },
  { name: "Música", color: "pink" as const },
  { name: "Casos", color: "cyan" as const },
];
---

<BaseLayout
  title="Blog | Andrés Ignacio Maldonado"
  description="Artículos, ideas y casos reales sobre tecnología, liderazgo y música"
>
  <Wrapper>
    <NeonBox class="max-w-6xl mx-auto" transitionName="blog-page">
      <div class="fade-in">
        <!-- Header del Blog -->
        <div class="p-12">
          <div
            class="flex flex-col md:flex-row md:items-center md:justify-between mb-8"
          >
            <div>
              <h1 class="text-5xl md:text-6xl font-bold mb-4 text-base-light">
                Blog
              </h1>
              <p class="text-xl text-base-grey">
                Artículos, ideas y casos reales
              </p>
            </div>

            <div class="mt-6 md:mt-0">
              <div class="flex items-center gap-4 mb-4">
                <span class="text-sm text-base-grey"
                  >andres-maldonado.com/blog</span
                >
              </div>
              <div class="w-full md:w-80">
                <SearchBox />
              </div>
            </div>
          </div>

          <!-- Filtros de categorías -->
          <div class="mb-12">
            <CategoryFilter categories={categories} />
          </div>
        </div>

        <!-- Artículo destacado -->
        <FeaturedSection
          featuredPost={featuredPost}
          regularPosts={regularPosts}
        />

        <!-- Fila inferior de artículos -->
        <ArticlesGrid posts={regularPosts.slice(2, 5)} />

        <!-- Suscripción -->
        <SubscriptionSection />
      </div>
    </NeonBox>
  </Wrapper>
</BaseLayout>
