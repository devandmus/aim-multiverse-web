---
interface Props {
  class?: string;
  contentClass?: string;
  borderClass?: {
    mobile?: [number, number, number, number]; // [top, right, bottom, left]
    desktop?: [number, number, number, number]; // [top, right, bottom, left]
  };
  transitionName?: string;
  color?: "pink" | "yellow" | "cyan" | "purple";
}

const {
  class: className = "",
  contentClass = "",
  borderClass,
  transitionName = "",
  color,
} = Astro.props;

const getNeonColor = (color: "pink" | "yellow" | "cyan" | "purple") => {
  const colorMap = {
    pink: "#ff00a0",
    yellow: "#f8f32b",
    cyan: "#00fff7",
    purple: "#a020f0",
  };
  return colorMap[color];
};

const generateBorderStyles = (borders: [number, number, number, number]) => {
  const [top, right, bottom, left] = borders;
  return {
    borderTopWidth: top > 0 ? `${top}px` : "0px",
    borderRightWidth: right > 0 ? `${right}px` : "0px",
    borderBottomWidth: bottom > 0 ? `${bottom}px` : "0px",
    borderLeftWidth: left > 0 ? `${left}px` : "0px",
  };
};
---

<div class={`neon-wrapper ${className}`}>
  <div
    class={`neon-box ${className} ${color ? "static-color" : ""}`}
    style={`${color ? `--neon-color: ${getNeonColor(color)};` : ""} ${transitionName ? `view-transition-name: ${transitionName}` : ""}`}
    data-border-config={borderClass ? JSON.stringify(borderClass) : ""}
  >
  </div>
  <div
    class={`neon-content h-full ${contentClass}`}
    data-border-config={borderClass ? JSON.stringify(borderClass) : ""}
  >
    <slot />
  </div>
</div>

<style>
  .neon-wrapper {
    position: relative;
    display: inline-block;
    background-color: #000000;
  }

  .neon-box {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;

    /* Propiedades comunes de borde */
    border-style: solid;
    border-color: transparent;

    /* Borde neon animado (por defecto) */
    background-image: linear-gradient(#000000, #000000),
      linear-gradient(135deg, #ff00a0, #00fff7, #a020f0, #f8f32b);
    background-origin: border-box;
    background-clip: padding-box, border-box;

    /* Animación del gradiente */
    animation: neon-move 6s linear infinite;
    background-size: 300% 300%;
  }

  /* Bordes por defecto cuando no hay configuración */
  .neon-box:not([data-border-config]) {
    border-width: 1px;
  }

  /* Estilos dinámicos para mobile */
  .neon-box[data-border-config] {
    border-width: 1px;
  }

  /* Estilos dinámicos para desktop (>= 768px) */
  @media (min-width: 768px) {
    .neon-box[data-border-config] {
      border-width: 1px;
    }
  }

  /* Estilo para color estático */
  .neon-box.static-color {
    background-image: linear-gradient(#000000, #000000),
      linear-gradient(135deg, var(--neon-color), var(--neon-color));
    animation: none;
    background-size: auto;
  }

  .neon-content {
    position: relative;
    border-style: solid;
    border-color: transparent;
  }

  /* Bordes por defecto cuando no hay configuración */
  .neon-content:not([data-border-config]) {
    border-width: 1px;
  }

  /* Estilos dinámicos para mobile */
  .neon-content[data-border-config] {
    border-width: 1px;
  }

  /* Estilos dinámicos para desktop (>= 768px) */
  @media (min-width: 768px) {
    .neon-content[data-border-config] {
      border-width: 1px;
    }
  }

  @keyframes neon-move {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }
</style>

<script>
  // Función para aplicar estilos de borde dinámicos
  function applyBorderStyles() {
    const elements = document.querySelectorAll("[data-border-config]");

    elements.forEach((element) => {
      const config = element.getAttribute("data-border-config");
      if (!config) return;

      try {
        const borderConfig = JSON.parse(config);
        const isDesktop = window.innerWidth >= 768;
        const borders = isDesktop ? borderConfig.desktop : borderConfig.mobile;

        if (borders) {
          const [top, right, bottom, left] = borders;
          element.style.borderTopWidth = top > 0 ? `${top}px` : "0px";
          element.style.borderRightWidth = right > 0 ? `${right}px` : "0px";
          element.style.borderBottomWidth = bottom > 0 ? `${bottom}px` : "0px";
          element.style.borderLeftWidth = left > 0 ? `${left}px` : "0px";
        }
      } catch (e) {
        console.warn("Error parsing border config:", e);
      }
    });
  }

  // Aplicar estilos al cargar
  document.addEventListener("DOMContentLoaded", applyBorderStyles);

  // Aplicar estilos al redimensionar
  window.addEventListener("resize", applyBorderStyles);
</script>
