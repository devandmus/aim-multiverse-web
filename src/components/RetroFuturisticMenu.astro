---
import NeonLink from "./atoms/NeonLink.astro";
---

<style>
  /* Estilos críticos para evitar parpadeo */
  #retro-menu-system {
    z-index: 999999 !important;
    isolation: isolate !important;
  }

  #hamburger-trigger {
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease;
  }

  #back-arrow {
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.5s ease,
      visibility 0.5s ease;
  }
</style>

<div id="retro-menu-system" class="fixed inset-0 z-50 pointer-events-none">
  <!-- Flecha de navegación hacia atrás -->
  <div
    id="back-arrow"
    class="fixed top-6 left-6 pointer-events-auto opacity-0 transition-all duration-500 transform"
    style="isolation: isolate; will-change: transform, opacity; visibility: hidden;"
  >
    <button
      id="back-btn"
      class="group relative w-12 h-12 bg-black backdrop-blur-xl border border-neon-cyan/50 rounded-full flex items-center justify-center hover:border-neon-cyan hover:bg-neon-cyan/10 transition-all duration-300 hover:scale-110 cursor-pointer"
    >
      <svg
        class="w-6 h-6 text-neon-cyan group-hover:text-white transition-colors"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          fill-rule="evenodd"
          d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
          clip-rule="evenodd"></path>
      </svg>
      <div
        class="absolute inset-0 rounded-full bg-gradient-to-r from-neon-cyan/20 to-neon-pink/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
      >
      </div>
    </button>
  </div>

  <!-- Botón hamburguesa -->
  <div
    id="hamburger-trigger"
    class="fixed top-6 right-6 pointer-events-auto"
    style="isolation: isolate; will-change: transform; opacity: 0; visibility: hidden;"
  >
    <button
      id="menu-toggle"
      class="group relative w-12 h-12 bg-black/80 backdrop-blur-xl border border-neon-pink/50 rounded-full flex items-center justify-center hover:border-neon-pink hover:bg-neon-pink/10 transition-all duration-300 hover:scale-110 cursor-pointer"
    >
      <div
        class="relative w-6 h-6 flex items-center justify-center"
        id="menu-icon"
      >
        <!-- Ícono de menú (3 líneas horizontales) -->
        <div class="menu-lines">
          <div
            class="w-4 h-0.5 bg-neon-pink mb-1 transition-all duration-300 group-hover:bg-white"
          >
          </div>
          <div
            class="w-4 h-0.5 bg-neon-pink mb-1 transition-all duration-300 group-hover:bg-white"
          >
          </div>
          <div
            class="w-4 h-0.5 bg-neon-pink transition-all duration-300 group-hover:bg-white"
          >
          </div>
        </div>
        <!-- Ícono de cerrar (X) -->
        <div class="close-icon absolute opacity-0 transition-all duration-300">
          <svg
            class="w-5 h-5 text-neon-pink group-hover:text-white"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
        </div>
      </div>
      <div
        class="absolute inset-0 rounded-full bg-gradient-to-r from-neon-pink/20 to-neon-yellow/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
      >
      </div>
    </button>
  </div>

  <!-- Menú pantalla completa -->
  <div
    id="fullscreen-menu"
    class="fixed inset-0 bg-black/95 backdrop-blur-2xl z-40 pointer-events-none opacity-0 scale-95 transition-all duration-700 transform overflow-y-auto flex items-center justify-center"
  >
    <div class="relative z-10 p-6">
      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-4xl mx-auto"
      >
        <NeonLink href="/">
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
            </svg>
            Inicio
          </h3>
          <p class="text-base-grey text-xs">Portal principal</p>
        </NeonLink>

        <NeonLink href="/blog">
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
              ></path>
            </svg>
            Blog / Artículos
          </h3>
          <p class="text-base-grey text-xs">AI • Tech • Música • Liderazgo</p>
        </NeonLink>

        <NeonLink href="/hub">
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"></path>
            </svg>
            Hub / Media
          </h3>
          <p class="text-base-grey text-xs">YouTube • TikTok • WhatsApp</p>
        </NeonLink>
        <NeonLink
          href="https://tiktok.com/@devandmus"
          target="_blank"
          rel="noopener noreferrer"
        >
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"
              ></path>
            </svg>
            TikTok
          </h3>
          <p class="text-base-grey text-xs pt-2">
            Live's todas las semanas y contenido musical
          </p>
        </NeonLink>

        <NeonLink
          href="https://linkedin.com/in/devandmus"
          target="_blank"
          rel="noopener noreferrer"
        >
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
              ></path>
            </svg>
            LinkedIn
          </h3>
          <p class="text-base-grey text-xs pt-2">
            Posts semanales sobre AI, tecnología y liderazgo
          </p>
        </NeonLink>

        <NeonLink
          href="https://wa.me/56938733949"
          target="_blank"
          rel="noopener noreferrer"
        >
          <h3
            class="text-lg font-bold text-base-light font-mono flex items-center justify-center gap-3"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"
              ></path>
            </svg>
            WhatsApp
          </h3>
          <p class="text-base-grey text-xs pt-2">
            Contacto directo • Consultoría • Cotizaciones
          </p>
        </NeonLink>
      </div>
    </div>
  </div>
</div>

<script>
  // Sistema de navegación retro-futurista
  class RetroFuturisticMenu {
    isMenuOpen: boolean = false;
    history: string[] = [];
    backArrow: HTMLElement | null = null;
    menuToggle: HTMLElement | null = null;
    fullscreenMenu: HTMLElement | null = null;
    floatingCtas: HTMLElement | null = null;

    constructor() {
      this.init();
    }

    init() {
      // Elementos del DOM
      this.backArrow = document.getElementById("back-arrow");
      this.menuToggle = document.getElementById("menu-toggle");
      this.fullscreenMenu = document.getElementById("fullscreen-menu");
      // CTAs flotantes eliminados

      // Inicializar visibilidad inmediatamente para evitar parpadeo
      this.initializeVisibility();

      // Event listeners
      this.menuToggle?.addEventListener("click", () => this.toggleMenu());
      document
        .getElementById("back-btn")
        ?.addEventListener("click", () => this.goBack());

      // Detectar navegación
      this.trackNavigation();

      // Manejar view transitions
      this.handleViewTransitions();

      // Efectos de partículas
      // this.createParticleEffects(); // Destellos deshabilitados
    }

    toggleMenu() {
      this.isMenuOpen = !this.isMenuOpen;

      if (this.isMenuOpen) {
        this.openMenu();
      } else {
        this.closeMenu();
      }
    }

    openMenu() {
      if (this.fullscreenMenu) {
        // Prevenir scroll del body
        document.body.style.overflow = "hidden";

        this.fullscreenMenu.style.pointerEvents = "auto";
        this.fullscreenMenu.style.opacity = "1";
        this.fullscreenMenu.style.scale = "1";

        // Ocultar flecha de navegación
        this.hideBackArrow();

        // Convertir menú en X
        this.transformHamburgerToX();

        // Animar elementos del menú
        const menuItems = this.fullscreenMenu.querySelectorAll(".menu-item");
        menuItems.forEach((item, index) => {
          const htmlItem = item as HTMLElement;
          htmlItem.style.opacity = "0";
          htmlItem.style.transform = "translateY(20px)";
          setTimeout(() => {
            htmlItem.style.transition = "all 0.3s ease";
            htmlItem.style.opacity = "1";
            htmlItem.style.transform = "translateY(0)";
          }, index * 100);
        });
      }

      // Efectos de sonido (opcional)
      // Sonido eliminado
    }

    closeMenu() {
      if (this.fullscreenMenu) {
        // Restaurar scroll del body
        document.body.style.overflow = "";

        this.fullscreenMenu.style.opacity = "0";
        this.fullscreenMenu.style.scale = "0.95";

        // Restaurar flecha de navegación
        this.trackNavigation();

        // Convertir X de vuelta a menú
        this.transformXToHamburger();

        // Delay para permitir que la animación termine antes de deshabilitar pointer-events
        setTimeout(() => {
          if (this.fullscreenMenu) {
            this.fullscreenMenu.style.pointerEvents = "none";
          }
        }, 700);
      }
    }

    initializeVisibility() {
      // Mostrar el botón hamburguesa inmediatamente
      if (this.menuToggle?.parentElement) {
        this.menuToggle.parentElement.style.opacity = "1";
        this.menuToggle.parentElement.style.visibility = "visible";
      }

      // Inicializar la flecha de navegación
      this.trackNavigation();
    }

    trackNavigation() {
      // NUNCA mostrar en la página home
      const isHomePage =
        window.location.pathname === "/" ||
        window.location.pathname === "/index.html" ||
        window.location.pathname === "";

      if (isHomePage) {
        this.hideBackArrow();
        return;
      }

      // Detectar si hay un referrer válido (página de origen)
      const hasValidReferrer =
        document.referrer &&
        document.referrer !== window.location.href &&
        document.referrer !== window.location.origin + "/" &&
        document.referrer !== window.location.origin;

      // Mostrar flecha solo si hay referrer válido O si hay historial del navegador
      const hasHistory = window.history.length > 1;

      if (hasValidReferrer || hasHistory) {
        this.showBackArrow();
      } else {
        this.hideBackArrow();
      }
    }

    showBackArrow() {
      if (this.backArrow) {
        this.backArrow.style.opacity = "1";
        this.backArrow.style.transform = "translateX(0)";
        this.backArrow.style.visibility = "visible";
        this.backArrow.style.pointerEvents = "auto";
      }
    }

    hideBackArrow() {
      if (this.backArrow) {
        this.backArrow.style.opacity = "0";
        this.backArrow.style.transform = "translateX(-16px)";
        this.backArrow.style.visibility = "hidden";
        this.backArrow.style.pointerEvents = "none";
      }
    }

    goBack() {
      // Usar el historial del navegador para volver atrás
      if (window.history.length > 1) {
        window.history.back();
      } else {
        // Si no hay historial, ir a la página principal
        window.location.href = "/";
      }
    }

    transformHamburgerToX() {
      const menuLines = document.querySelector(".menu-lines");
      const closeIcon = document.querySelector(".close-icon");

      if (menuLines && closeIcon) {
        (menuLines as HTMLElement).style.opacity = "0";
        (menuLines as HTMLElement).style.transform = "scale(0.8)";
        (closeIcon as HTMLElement).style.opacity = "1";
        (closeIcon as HTMLElement).style.transform = "scale(1)";
      }
    }

    transformXToHamburger() {
      const menuLines = document.querySelector(".menu-lines");
      const closeIcon = document.querySelector(".close-icon");

      if (menuLines && closeIcon) {
        (menuLines as HTMLElement).style.opacity = "1";
        (menuLines as HTMLElement).style.transform = "scale(1)";
        (closeIcon as HTMLElement).style.opacity = "0";
        (closeIcon as HTMLElement).style.transform = "scale(0.8)";
      }
    }

    handleViewTransitions() {
      // Detectar cuando inician las view transitions
      document.addEventListener("astro:before-preparation", () => {
        // Asegurar que los elementos del menú mantengan su z-index
        if (this.backArrow) {
          this.backArrow.style.zIndex = "999999";
          this.backArrow.style.isolation = "isolate";
        }
        if (this.menuToggle?.parentElement) {
          this.menuToggle.parentElement.style.zIndex = "999999";
          this.menuToggle.parentElement.style.isolation = "isolate";
        }
      });

      // Detectar cuando terminan las view transitions
      document.addEventListener("astro:after-swap", () => {
        // Re-aplicar estilos después de la transición
        setTimeout(() => {
          if (this.backArrow) {
            this.backArrow.style.zIndex = "999999";
            this.backArrow.style.isolation = "isolate";
          }
          if (this.menuToggle?.parentElement) {
            this.menuToggle.parentElement.style.zIndex = "999999";
            this.menuToggle.parentElement.style.isolation = "isolate";
          }
          // Re-trackear navegación después de la transición
          this.trackNavigation();
        }, 100);
      });
    }

    // Funciones de partículas eliminadas - destellos deshabilitados

    // Función de sonido eliminada
  }

  // Inicializar cuando el DOM esté listo
  document.addEventListener("DOMContentLoaded", () => {
    new RetroFuturisticMenu();
  });

  // Efectos adicionales
  document.addEventListener("mousemove", (e) => {
    const cursor = document.querySelector(".cursor-glow");
    if (cursor) {
      const htmlCursor = cursor as HTMLElement;
      htmlCursor.style.left = e.clientX + "px";
      htmlCursor.style.top = e.clientY + "px";
    }
  });
</script>

<style>
  /* Efectos retro-futuristas adicionales */
  .menu-item {
    position: relative;
    overflow: hidden;
  }

  .menu-item::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(0, 255, 247, 0.1),
      transparent
    );
    transition: left 0.5s;
  }

  .menu-item:hover::before {
    left: 100%;
  }

  /* Cursor personalizado */
  .cursor-glow {
    position: fixed;
    width: 20px;
    height: 20px;
    background: radial-gradient(
      circle,
      rgba(0, 255, 247, 0.3) 0%,
      transparent 70%
    );
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    mix-blend-mode: screen;
  }

  /* Animaciones de entrada */
  @keyframes slideInFromTop {
    from {
      transform: translateY(-100px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideInFromBottom {
    from {
      transform: translateY(100px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideInFromLeft {
    from {
      transform: translateX(-100px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideInFromRight {
    from {
      transform: translateX(100px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* Efectos de hover mejorados sin sombras */
  .menu-item {
    border: 1px solid transparent;
  }

  .menu-item:hover {
    transform: translateY(-5px) scale(1.02);
    border: 1px solid rgba(0, 255, 247, 0.3);
    border-radius: 0px;
    background: linear-gradient(
      135deg,
      rgba(0, 255, 247, 0.05),
      rgba(255, 0, 160, 0.05)
    );
  }

  /* Efectos de hover específicos para cada tipo de elemento */
  .menu-item:nth-child(3n + 1):hover {
    border-color: rgba(0, 255, 247, 0.3);
    border-radius: 0px;
    background: linear-gradient(135deg, rgba(0, 255, 247, 0.08), transparent);
  }

  .menu-item:nth-child(3n + 2):hover {
    border-color: rgba(255, 0, 160, 0.3);
    border-radius: 0px;
    background: linear-gradient(135deg, rgba(255, 0, 160, 0.08), transparent);
  }

  .menu-item:nth-child(3n + 3):hover {
    border-color: rgba(248, 243, 43, 0.3);
    border-radius: 0px;
    background: linear-gradient(135deg, rgba(248, 243, 43, 0.08), transparent);
  }

  /* Transiciones de menú a X */
  .menu-lines,
  .close-icon {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
  }

  .menu-lines {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Asegurar máxima prioridad de apilamiento para elementos del menú */
  #back-arrow,
  #hamburger-trigger {
    position: fixed !important;
    z-index: 999999 !important;
    isolation: isolate !important;
    contain: layout style paint !important;
  }

  /* Override para view transitions */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    z-index: 999998;
  }

  /* Asegurar que el menú esté por encima de las view transitions */
  #retro-menu-system {
    z-index: 999999 !important;
    isolation: isolate !important;
  }

  /* Efectos de partículas eliminados - destellos deshabilitados */

  /* Efecto de border-radius: 0 en hover para todos los botones del menú */
  #fullscreen-menu .menu-item button:hover,
  #fullscreen-menu .menu-item a:hover {
    border-radius: 0px !important;
  }
</style>
