---
import type { CollectionEntry } from "astro:content";
import NeonBox from "./atoms/NeonBox.astro";

export interface Props {
    currentPost: CollectionEntry<"blog"> | null;
    allPosts: CollectionEntry<"blog">[];
}

const { currentPost, allPosts } = Astro.props;

// Filtrar posts que no son draft y ordenar por fecha
const publishedPosts = allPosts
    .filter((post) => !post.data.draft)
    .sort(
        (a, b) =>
            new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
    );

// Encontrar el índice del post actual
const currentIndex = publishedPosts.findIndex(
    (post) => post.slug === currentPost?.slug,
);

// Navegación infinita
const previousIndex =
    currentIndex === 0 ? publishedPosts.length - 1 : currentIndex - 1;
const nextIndex =
    currentIndex === publishedPosts.length - 1 ? 0 : currentIndex + 1;

const previousPost = publishedPosts[previousIndex];
const nextPost = publishedPosts[nextIndex];
---

<div class="mt-16">
    <div class="max-w-6xl mx-auto px-6">
        <div class="grid md:grid-cols-2 gap-6">
            <!-- Artículo Anterior -->
            <NeonBox color="cyan" class="rounded-lg">
                <a href={`/blog/${previousPost.slug}`} class="h-full">
                    <div class="flex items-center gap-4 p-6 h-full">
                        <div class="flex-shrink-0">
                            <div
                                class="w-8 h-8 bg-neon-cyan rounded-full flex items-center justify-center group-hover:scale-110 transition-transform"
                            >
                                <svg
                                    class="w-4 h-4 text-base-dark rotate-180"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div
                                class="text-white font-semibold text-lg leading-tight line-clamp-2"
                                style={`view-transition-name: article-title-${previousPost.slug}`}
                            >
                                {previousPost.data.title}
                            </div>
                            <div
                                class="text-gray-400 text-sm mt-1 line-clamp-1"
                            >
                                {previousPost.data.description}
                            </div>
                        </div>
                    </div>
                </a>
            </NeonBox>

            <!-- Artículo Siguiente -->
            <NeonBox color="pink" class="rounded-lg">
                <a href={`/blog/${nextPost.slug}`} class="h-full">
                    <div class="flex items-center gap-4 p-6 h-full">
                        <div class="flex-1 min-w-0 text-right">
                            <div
                                class="text-white font-semibold text-lg leading-tight line-clamp-2"
                                style={`view-transition-name: article-title-${nextPost.slug}`}
                            >
                                {nextPost.data.title}
                            </div>
                            <div
                                class="text-gray-400 text-sm mt-1 line-clamp-1"
                            >
                                {nextPost.data.description}
                            </div>
                        </div>
                        <div class="flex-shrink-0">
                            <div
                                class="w-8 h-8 bg-neon-pink rounded-full flex items-center justify-center group-hover:scale-110 transition-transform"
                            >
                                <svg
                                    class="w-4 h-4 text-base-dark"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>
            </NeonBox>
        </div>
    </div>
</div>

<style>
    .line-clamp-1 {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
